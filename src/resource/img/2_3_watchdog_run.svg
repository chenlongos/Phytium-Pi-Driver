<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>看门狗定时器工作原理（修正版）</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
        }
        
        .container {
            max-width: 1000px;
            background: rgba(0, 10, 20, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            margin-top: 20px;
        }
        
        h1 {
            text-align: center;
            color: #4fc3f7;
            text-shadow: 0 0 15px rgba(79, 195, 247, 0.8);
            margin-bottom: 5px;
            font-size: 2.2em;
        }
        
        .subtitle {
            text-align: center;
            color: #e0f7fa;
            font-size: 1.2em;
            margin-bottom: 25px;
        }
        
        .diagram-container {
            background: #0a1929;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #1e3a5f;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px;
            font-size: 1.1em;
        }
        
        .legend-color {
            width: 25px;
            height: 25px;
            border-radius: 4px;
            margin-right: 10px;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }
        
        .explanation {
            background: rgba(25, 118, 210, 0.2);
            border-left: 4px solid #29b6f6;
            padding: 20px;
            border-radius: 0 12px 12px 0;
            margin: 30px 0;
            font-size: 1.1em;
        }
        
        .steps {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 25px;
        }
        
        .step-card {
            background: rgba(25, 118, 210, 0.25);
            border-radius: 10px;
            padding: 20px;
            flex: 1;
            min-width: 200px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .step-card:hover {
            transform: translateY(-7px);
            background: rgba(25, 118, 210, 0.35);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        .step-number {
            background: #4fc3f7;
            color: #0a1929;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.2em;
            box-shadow: 0 0 10px rgba(79, 195, 247, 0.7);
        }
        
        .highlight {
            color: #4fc3f7;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(79, 195, 247, 0.5);
        }
        
        footer {
            margin-top: 30px;
            text-align: center;
            color: #bbdefb;
            font-size: 1em;
            padding: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .steps {
                flex-direction: column;
            }
            
            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>看门狗定时器（Watchdog Timer）工作原理</h1>
        
        <div class="diagram-container">
            <svg width="100%" height="550" viewBox="0 0 850 550" xmlns="http://www.w3.org/2000/svg">
                <!-- 微控制器 -->
                <rect x="50" y="50" width="320" height="450" rx="12" fill="#0d47a1" stroke="#29b6f6" stroke-width="3" filter="url(#glow)"/>
                <text x="210" y="85" text-anchor="middle" fill="white" font-size="22" font-weight="bold">微控制器 (MCU)</text>
                
                <!-- 主程序流程 -->
                <path d="M130 130 L130 170 L300 170 L300 210 L130 210 L130 250 L300 250 L300 290 L130 290 L130 330 L300 330 L300 370 L130 370 L130 410" 
                      fill="none" stroke="#81c784" stroke-width="4" stroke-dasharray="8,4"/>
                
                <!-- 程序模块 -->
                <rect x="140" y="150" width="150" height="35" rx="6" fill="#1e88e5"/>
                <text x="215" y="172" text-anchor="middle" fill="white" font-size="16">初始化</text>
                
                <rect x="140" y="190" width="150" height="35" rx="6" fill="#1e88e5"/>
                <text x="215" y="212" text-anchor="middle" fill="white" font-size="16">任务A</text>
                
                <rect x="140" y="230" width="150" height="35" rx="6" fill="#1e88e5"/>
                <text x="215" y="252" text-anchor="middle" fill="white" font-size="16">任务B</text>
                
                <rect x="140" y="270" width="150" height="35" rx="6" fill="#1e88e5"/>
                <text x="215" y="292" text-anchor="middle" fill="white" font-size="16">任务C</text>
                
                <rect x="140" y="310" width="150" height="35" rx="6" fill="#43a047"/>
                <text x="215" y="332" text-anchor="middle" fill="white" font-size="16">喂狗操作</text>
                
                <rect x="140" y="350" width="150" height="35" rx="6" fill="#1e88e5"/>
                <text x="215" y="372" text-anchor="middle" fill="white" font-size="16">任务D</text>
                
                <!-- 程序跑飞 -->
                <path d="M130 230 L40 230 L40 380 L130 380" fill="none" stroke="#e57373" stroke-width="4" stroke-dasharray="5,5"/>
                <text x="40" y="220" text-anchor="middle" fill="#e57373" font-size="16">程序跑飞</text>
                <circle cx="40" cy="380" r="18" fill="#e53935"/>
                <text x="40" y="385" text-anchor="middle" fill="white" font-size="16">X</text>
                
                <!-- 看门狗定时器 -->
                <rect x="530" y="80" width="270" height="350" rx="12" fill="#5e35b1" stroke="#ba68c8" stroke-width="3"/>
                <text x="665" y="115" text-anchor="middle" fill="white" font-size="22" font-weight="bold">看门狗定时器</text>
                
                <!-- 计数器容器 -->
                <rect x="560" y="170" width="210" height="200" fill="#4527a0" rx="6"/>
                <rect x="570" y="180" width="190" height="180" fill="#7e57c2" rx="6"/>
                
                <!-- 计数过程 - 修正为向下增长 -->
                <rect id="counter" x="575" y="180" width="180" height="0" fill="#e53935" rx="4">
                    <animate attributeName="height" from="0" to="180" begin="0s; reset.end" dur="10s" fill="freeze" id="countup"/>
                </rect>
                
                <!-- 阈值线 -->
                <line x1="560" y1="300" x2="770" y2="300" stroke="#ff9800" stroke-width="4" stroke-dasharray="6,6"/>
                <text x="770" y="295" text-anchor="end" fill="#ff9800" font-size="16">溢出阈值</text>
                
                <!-- 重置动画 -->
                <rect x="575" y="180" width="180" height="180" fill="#43a047" rx="4" opacity="0">
                    <animate attributeName="opacity" from="0" to="1" begin="kick.end" dur="0.1s" fill="freeze" id="reset"/>
                    <animate attributeName="opacity" from="1" to="0" begin="reset.end" dur="0.5s" fill="freeze"/>
                </rect>
                
                <!-- 喂狗信号 -->
                <path d="M300 330 L350 330 L350 220 L530 220" fill="none" stroke="#81c784" stroke-width="4">
                    <animate attributeName="stroke-dashoffset" from="0" to="100" dur="1.5s" begin="0s; reset.end+1s" repeatCount="indefinite" 
                             values="0; -100" keyTimes="0;1" keySplines="0.5 0 0.5 1" calcMode="spline"/>
                </path>
                <circle cx="300" cy="330" r="10" fill="#81c784"/>
                <circle cx="530" cy="220" r="10" fill="#81c784"/>
                <text x="420" y="210" text-anchor="middle" fill="#81c784" font-size="18">喂狗信号</text>
                
                <!-- 复位信号 -->
                <path d="M530 330 L400 330 L400 460 L100 460 L100 420" fill="none" stroke="#ef5350" stroke-width="4" opacity="0">
                    <animate attributeName="opacity" from="0" to="1" begin="countup.end" dur="0.5s" fill="freeze" id="resetSignal"/>
                </path>
                <circle cx="530" cy="330" r="10" fill="#ef5350" opacity="0">
                    <animate attributeName="opacity" from="0" to="1" begin="countup.end" dur="0.5s" fill="freeze"/>
                </circle>
                <circle cx="100" cy="420" r="10" fill="#ef5350" opacity="0">
                    <animate attributeName="opacity" from="0" to="1" begin="countup.end" dur="0.5s" fill="freeze"/>
                </circle>
                <text x="400" y="450" text-anchor="middle" fill="#ef5350" font-size="18" opacity="0">
                    <animate attributeName="opacity" from="0" to="1" begin="countup.end" dur="0.5s" fill="freeze">复位信号</animate>
                </text>
                
                <!-- 喂狗动画 -->
                <g>
                    <circle cx="530" cy="220" r="20" fill="none" stroke="#81c784" stroke-width="4" opacity="0">
                        <animate attributeName="opacity" from="0" to="1" begin="0s; reset.end+1s" dur="0.5s" fill="freeze" id="kick"/>
                        <animate attributeName="r" from="20" to="35" begin="kick.begin" dur="0.5s" fill="freeze"/>
                        <animate attributeName="opacity" from="1" to="0" begin="kick.begin+0.5s" dur="0.5s" fill="freeze"/>
                    </circle>
                </g>
                
                <!-- 复位效果 -->
                <rect x="50" y="50" width="320" height="450" rx="12" fill="none" stroke="#ef5350" stroke-width="5" opacity="0">
                    <animate attributeName="opacity" from="0" to="1" begin="resetSignal.begin" dur="0.5s" repeatCount="2" fill="freeze"/>
                </rect>
                
                <!-- 状态标签 -->
                <text x="665" y="390" text-anchor="middle" fill="white" font-size="18">计数器 (向下增长)</text>
                
                <!-- 正常操作标签 -->
                <text x="665" y="150" text-anchor="middle" fill="#81c784" font-size="20" font-weight="bold">正常操作：定期喂狗</text>
                
                <!-- 故障操作标签 -->
                <text x="665" y="420" text-anchor="middle" fill="#ef5350" font-size="20" font-weight="bold" opacity="0">
                    <animate attributeName="opacity" from="0" to="1" begin="countup.end" dur="0.5s" fill="freeze">故障：触发系统复位</animate>
                </text>
                
                <!-- 计数器方向说明 -->
                <path d="M575 180 L575 360" fill="none" stroke="#a0a0a0" stroke-width="2" stroke-dasharray="4,4"/>
                <path d="M575 360 L570 355 M575 360 L580 355" fill="none" stroke="#a0a0a0" stroke-width="2"/>
                <text x="565" y="320" text-anchor="end" fill="#a0a0a0" font-size="14" transform="rotate(-90,565,320)">计数器增长方向</text>
                
                <!-- 发光效果 -->
                <filter id="glow">
                    <feGaussianBlur stdDeviation="3.5" result="blur"/>
                    <feComposite in="SourceGraphic" in2="blur" operator="over"/>
                </filter>
            </svg>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #1e88e5;"></div>
                <span>正常程序任务</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #43a047;"></div>
                <span>喂狗操作</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e53935;"></div>
                <span>计数器增长</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ef5350;"></div>
                <span>复位信号</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #81c784;"></div>
                <span>喂狗信号</span>
            </div>
        </div>
        
        <!-- <div class="explanation">
            <h3>修正说明：计数器方向</h3>
            <p>在初始设计中，计数器被错误地表示为向上增长。在实际的看门狗定时器工作原理中：</p>
            <ul>
                <li>计数器从<strong class="highlight">高值开始递减</strong>（或从零开始递增）</li>
                <li>当计数器达到零（递减模式）或最大值（递增模式）时触发复位</li>
                <li>喂狗操作会将计数器<strong class="highlight">重置到初始值</strong></li>
            </ul>
            <p>在修正版中，计数器被正确地表示为<strong class="highlight">向下增长</strong>（从0开始递增至最大值），当达到阈值时触发复位，这更符合实际硬件实现。</p>
        </div> -->
        
        <h2>看门狗定时器工作原理步骤</h2>
        <div class="steps">
            <div class="step-card">
                <div class="step-number">1</div>
                <p>系统启动时，看门狗定时器被初始化，计数器设置为<strong class="highlight">初始值（通常为0）</strong>。</p>
            </div>
            <div class="step-card">
                <div class="step-number">2</div>
                <p>程序正常运行时，需<strong class="highlight">定期执行喂狗操作</strong>，将计数器重置为初始值。</p>
            </div>
            <div class="step-card">
                <div class="step-number">3</div>
                <p>看门狗定时器<strong class="highlight">独立计时</strong>，计数器随时间递增（或递减）。</p>
            </div>
            <div class="step-card">
                <div class="step-number">4</div>
                <p>当程序出现故障（死循环、跑飞等）时，<strong class="highlight">无法执行喂狗操作</strong>。</p>
            </div>
            <div class="step-card">
                <div class="step-number">5</div>
                <p>计数器达到预设的<strong class="highlight">溢出阈值</strong>，触发系统复位信号。</p>
            </div>
            <div class="step-card">
                <div class="step-number">6</div>
                <p>系统被<strong class="highlight">强制重启</strong>，恢复到初始状态。</p>
            </div>
        </div>
    </div>
    
    <!-- <footer>
        <p>看门狗定时器工作原理图解（修正版） | 嵌入式系统可靠性设计 | SVG技术实现</p>
    </footer> -->
</body>
</html>s